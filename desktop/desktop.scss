/* ==========================================================================
   NO-OP legacy placeholders (safe to remove if you prefer hard failures)
   ========================================================================== */
%blog-tag {}
%blog-category {}
%builder-wide-layout {}

/* ==========================================================================
   Base mixins (only take effect when included inside builder-labs)
   ========================================================================== */
@mixin blog_base() {
  .topic-timeline { display: none; }

  .blog-image-container {
    text-align: center;
    .blog-image {
      background-position: center center;
      background-repeat: no-repeat;
      background-size: contain;
      height: 440px;
      margin-bottom: 1em;
      @if $image_display_style == "responsive crop" { background-size: cover; width: 100%; }
    }
  }

  /* Hide byline under the title for the first post */
  #post_1 .topic-avatar,
  #post_1 .topic-body .topic-meta-data,
  #post_1 .post-info.edits { display: none !important; }

  .topic-body { width: 100%; }

  .topic-avatar {
    height: 20px; width: 20px; background: none;
    img.avatar { height: 20px; width: 20px; }
    .avatar-flair {
      background-size: 8px 8px;
      width: 10px; height: 10px;
      top: unset; bottom: -5px; right: -3px;
      .d-icon { height: .45em; width: .45em; }
    }
  }

  .topic-map.--bottom { display: none !important; }

  #post_1 {
    .topic-body {
      padding-top: 8px; border-top: none;
      &.highlighted { animation: none; }
      .contents { border-top: 1px solid var(--primary-low); margin-left: 0; padding: 0; }
    }

    .topic-map.--op {
      padding-left: 0;

      /* Hardened: comments heading scoped ONLY to builder-labs */
      body.category-builder-labs & .comments-heading {
        display: block;
        width: 100%;
        margin-top: 1em;
      }

      .topic-map__users-list { display: none; }
    }
  }

  .post-infos img.avatar { height: 20px; width: 20px; }

  .topic-status-info,
  .topic-timer-info,
  .small-action .small-action-desc { width: 100%; max-width: 100%; }

  .post-notice { max-width: 519px; font-size: var(--font-down-2); }

  .small-action {
    font-size: .75em;
    .small-action-desc {
      max-width: 500px;
      .small-action-contents { display: flex; align-items: center; .avatar { height: 15px; width: 15px; } }
    }
  }

  #topic-title h1 { font-size: 2.5em; }
  #topic-title a.edit-topic .d-icon { font-size: .5em; }

  .topic-meta-data { font-size: small; }
  .cooked { padding: .5em 1em; }
}

/* ==========================================================================
   Wide layout mixin (TOC flush left, content right, adjusted spacing + font)
   ========================================================================== */
@mixin builder_wide_layout() {
  --toc-gap: 2rem; /* clean space between TOC and content */
  --toc-width-min: 18rem;
  --toc-width-max: 22rem;
  --content-cap: clamp(1020px, 80ch, 1500px);

  /* Remove all left rails/padding */
  .wrap, .d-wrap, #main-outlet-wrap, #main-outlet {
    margin-left: 0 !important;
    padding-left: 0 !important;
    max-width: none !important;
    width: 100% !important;
  }

  #topic-title { justify-content: flex-start !important; }
  #topic-title .title-wrapper {
    width: 100% !important;
    max-width: var(--content-cap) !important;
    margin: 0 !important; padding: 0 !important;
  }

  .container.posts {
    display: grid !important;
    margin-left: 0 !important;
    padding-left: 0 !important;
    width: 100% !important;
    grid-template-columns:
      minmax(var(--toc-width-min), var(--toc-width-max)) /* TOC */
      minmax(0, 1fr) /* Content */ !important;
    column-gap: var(--toc-gap) !important;
  }

  .container.posts > .row {
    width: auto !important;
    grid-column: 2 / 3; /* Content on the right */
  }

  .container.posts .topic-navigation {
    grid-column: 1 / 2; /* TOC on the left */
    align-self: start;
    position: sticky; top: 6rem;
    margin-left: 0 !important;
    font-size: 1.05em; /* â†‘ bump TOC font size slightly */
    line-height: 1.5;
  }
  .container.posts .topic-navigation .d-toc-main {
    min-width: var(--toc-width-min) !important;
    max-width: var(--toc-width-max) !important;
  }

  .topic-post .topic-body {
    margin-left: 0 !important; padding-left: 0 !important;
    max-width: var(--content-cap) !important; width: 100% !important;
  }
}

/* ==========================================================================
   Concise scoping helpers (slug: builder-labs)
   ========================================================================== */
$lab-sel: 'body.category-builder-labs';
@mixin in-lab { #{$lab-sel} { @content; } }
@mixin dark-in-lab {
  @media (prefers-color-scheme: dark){ #{$lab-sel} { @content; } }
  html.dark #{$lab-sel},
  html[data-theme="dark"] #{$lab-sel},
  html[data-theme="Dark"] #{$lab-sel},
  html[data-theme-color-scheme="dark"] #{$lab-sel} { @content; }
}

/* ==========================================================================
   Apply (only when slug === builder-labs)
   ========================================================================== */
@include in-lab {
  /* Hide main nav/sidebar just for Labs to reclaim the left edge */
  .sidebar-wrapper,
  .sidebar-container,
  .hamburger-panel,
  .discourse-sidebar,
  .sidebar-section { display: none !important; }

  @include blog_base();
  &.archetype-regular { @include builder_wide_layout(); }

  /* Headings */
  .cooked h1 {
    padding: .25em .5em;
    margin-top: 2em;
    margin-bottom: 1em;
    padding-block: .75em;
    background-color: #000; color: #fff;
  }
  .cooked h2 {
    padding: .25em .5em;
    margin-top: 2em;
    margin-bottom: 1em;
    padding-block: .25em;
    background-color: #b2b2b2; /* brand gray */
    color: #000;
  }
}

/* ---------- DARK variant ---------- */
@include dark-in-lab {
  --lab-surface-dark: #0c0f14;
  --fg-strong: #edf2f8;
  .cooked blockquote { color: var(--fg-strong); }
}
