/* =========================================================
   Celigo — Builder Labs
   Two-column layout (TOC left, content right) + callouts
   Safe, single-scope: only affects body.category-builder-labs
   ========================================================= */

/* -----------------------------
   Tunables (edit to taste)
   ----------------------------- */
body.category-builder-labs {
  /* Page framing */
  --page-max: 1200px;                 /* overall page max width */
  --site-gutter: clamp(12px, 2.5vw, 20px);

  /* TOC column */
  --toc-gap: 2rem;
  --toc-width-min: 18rem;
  --toc-width-max: 22rem;
  --header-height: 64px;              /* your header height */
  --toc-offset: 16px;                 /* extra space below header when sticky */

  /* Content width (article column) */
  --post-max: 720px;

  /* Callouts — rails, spacing, colors */
  --callout-rail: clamp(16px, 1.4vw, 20px);
  --callout-radius: 12px;
  --callout-pad-y: 12px;
  --callout-pad-x: 16px;
  --callout-indent: 26px;

  --callout-icon-size: clamp(28px, 2.2vw, 34px);
  --callout-icon-gap: 20px;
  --callout-left-pad: calc(var(--callout-rail) + 8px);
  --callout-icon-nudge: -1px;

  /* Brand palette */
  --brand-lagoon:      #86B0B6;
  --brand-driftwood:   #887E6F;
  --brand-peach:       #F3B38F;
  --brand-chaparral:   #596D67;
  --brand-karl:        #B4C5CB;
  --brand-periwinkle:  #CDC6E6;
  --brand-beaujolais:  #D893AF;
  --brand-wheatgrass:  #D6C56B;
  --brand-aspen:       #CED8A3;

  /* Tone aliases */
  --tone-term:    var(--brand-peach);
  --tone-hint:    var(--brand-lagoon);
  --tone-pro:     var(--brand-chaparral);
  --tone-note:    var(--brand-aspen);
  --tone-success: var(--brand-periwinkle);
  --tone-time:    var(--brand-beaujolais);

  /* Text + surfaces */
  --fg-strong: #243041;
  --light-surface: #ffffff;

  /* Tint mixes (light mode) */
  --tint-term:    66%;
  --tint-hint:    34%;
  --tint-pro:     18%;
  --tint-note:    36%;
  --tint-success: 70%;
  --tint-time:    58%;
}

/* =========================================================
   Layout framing: keep header + page at same max width
   ========================================================= */
:is(body.category-builder-labs) .d-header .wrap,
:is(body.category-builder-labs) .d-header .contents,
:is(body.category-builder-labs) #main-outlet-wrap,
:is(body.category-builder-labs) #main-outlet {
  max-width: var(--page-max) !important;
  margin-left: auto !important;
  margin-right: auto !important;
  width: 100% !important;
  padding-left: var(--site-gutter) !important;
  padding-right: var(--site-gutter) !important;
}

/* Kill any Discourse left-rail reservation for this category */
:is(body.category-builder-labs),
:is(body.category-builder-labs) :root { --d-sidebar-width: 0px !important; }
:is(body.category-builder-labs) .sidebar-wrapper,
:is(body.category-builder-labs) .sidebar-container,
:is(body.category-builder-labs) .discourse-sidebar,
:is(body.category-builder-labs) .d-sidebar,
:is(body.category-builder-labs) .hamburger-panel {
  display: none !important;
  width: 0 !important; min-width: 0 !important;
}
:is(body.category-builder-labs).has-sidebar .wrap,
:is(body.category-builder-labs).has-sidebar .d-wrap,
:is(body.category-builder-labs) .sidebar-wrapper + .wrap,
:is(body.category-builder-labs) .sidebar-wrapper + .d-wrap,
:is(body.category-builder-labs) #main-outlet-wrap {
  margin-left: 0 !important;
}

/* =========================================================
   Two-column grid: [ TOC | Content ]
   ========================================================= */
:is(body.category-builder-labs) #main-outlet {
  display: grid !important;
  grid-template-columns:
    minmax(var(--toc-width-min), var(--toc-width-max))
    minmax(0, 1fr) !important;
  column-gap: var(--toc-gap) !important;
}

/* Make the posts container “flow into” the parent grid */
:is(body.category-builder-labs) .container.posts { display: contents !important; }

/* Place TOC and content in their columns */
:is(body.category-builder-labs) .container.posts .topic-navigation { grid-column: 1 / 2 !important; }
:is(body.category-builder-labs) .container.posts > .row            { grid-column: 2 / 3 !important; }

/* Sticky TOC that never overlays the article */
:is(body.category-builder-labs) .container.posts .topic-navigation {
  align-self: start;
  position: sticky; 
  top: calc(var(--header-height) + var(--toc-offset));
  z-index: 2;
  font-size: 1.08rem; line-height: 1.5;
  margin: 0 !important;
  max-height: calc(100vh - var(--header-height) - (var(--toc-offset) * 2));
  overflow: auto;
}

/* Remove the TOC’s default left rule/padding so it aligns to grid edge */
:is(body.category-builder-labs) .topic-navigation .d-toc-main {
  border-left: none !important;
  padding-left: 0 !important;
  margin-left: 0 !important;
}

/* Title bar aligns to the same grid columns */
:is(body.category-builder-labs) #topic-title {
  grid-column: 1 / -1 !important;
  display: grid !important;
  grid-template-columns:
    minmax(var(--toc-width-min), var(--toc-width-max))
    minmax(0, 1fr) !important;
  column-gap: var(--toc-gap) !important;
  margin: 0 !important; padding: 0 !important;
}
/* Actual title sits in the content column for nice visual balance */
:is(body.category-builder-labs) #topic-title .title-wrapper {
  grid-column: 2 / 3 !important;
  max-width: none !important; width: 100% !important;
  margin: 0 !important; padding: 0 !important;
}

/* =========================================================
   Blog niceties + content width
   ========================================================= */
:is(body.category-builder-labs) .topic-timeline,
:is(body.category-builder-labs) .topic-map.--bottom,
:is(body.category-builder-labs) .timeline-toggle,
:is(body.category-builder-labs) #topic-progress-wrapper.docked,
:is(body.category-builder-labs) .timeline-container.timeline-docked { display: none !important; }

:is(body.category-builder-labs) .topic-post .topic-body {
  margin-left: 0 !important; padding-left: 0 !important;
  max-width: var(--post-max);
}

:is(body.category-builder-labs) .topic-post:first-child {
  font-size: 1.15em; line-height: 1.45; padding-top: 4px; padding-bottom: 0;
}
:is(body.category-builder-labs) .topic-post:first-child .cooked { padding: 0; }

/* Headings treatment (optional—kept from earlier) */
:is(body.category-builder-labs) .cooked h1 {
  margin: 2em 0 1em 0; padding: .75em .5em; background: #000; color: #fff;
}
:is(body.category-builder-labs) .cooked h2 {
  margin: 2em 0 1em 0; padding: .25em .5em; background: #b2b2b2; color: #000;
}

/* =========================================================
   Brand Callouts (emoji-triggered blockquotes)
   ========================================================= */
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji),
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child .d-icon),
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img:not(.emoji)) {
  --callout-bg: var(--note-bg);
  --callout-accent: var(--note-rail);

  position: relative;
  background: var(--callout-bg);
  border-left: var(--callout-rail) solid var(--callout-accent);
  border-radius: var(--callout-radius);
  padding: var(--callout-pad-y) var(--callout-pad-x);
  margin: 16px 0 16px var(--callout-indent);
  padding-left: calc(var(--callout-left-pad) + var(--callout-icon-size) + var(--callout-icon-gap)) !important;

  color: var(--callout-fg, var(--fg-strong));
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.45),
    0 0 0 1px color-mix(in hsl, var(--callout-accent) .14, transparent);
}

/* Emoji → tone mapping (light) */
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji[title=":green_book:"])       { --callout-bg: color-mix(in hsl, var(--tone-term)    var(--tint-term),    var(--light-surface)); --callout-accent: var(--tone-term); }
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji[title=":megaphone:"])        { --callout-bg: color-mix(in hsl, var(--tone-hint)    var(--tint-hint),    var(--light-surface)); --callout-accent: var(--tone-hint); }
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji[title=":hammer_and_wrench:"]){ --callout-bg: color-mix(in hsl, var(--tone-pro)     var(--tint-pro),     var(--light-surface)); --callout-accent: var(--tone-pro); }
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji[title=":pen:"])              { --callout-bg: color-mix(in hsl, var(--tone-note)    var(--tint-note),    var(--light-surface)); --callout-accent: var(--tone-note); }
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji[title=":sports_medal:"])     { --callout-bg: color-mix(in hsl, var(--tone-success) var(--tint-success), var(--light-surface)); --callout-accent: var(--tone-success); }
:is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji[title=":stopwatch:"])        { --callout-bg: color-mix(in hsl, var(--tone-time)    var(--tint-time),    var(--light-surface)); --callout-accent: var(--tone-time); }

/* Mobile: collapse icon lane without shrinking icons */
@media (max-width: 640px){
  :is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img.emoji),
  :is(body.category-builder-labs) .cooked blockquote:has(> p:first-child .d-icon),
  :is(body.category-builder-labs) .cooked blockquote:has(> p:first-child img:not(.emoji)){
    padding-left: var(--callout-pad-x) !important;
  }
  :is(body.category-builder-labs) .cooked blockquote > p:first-child{
    display: flex; align-items: center; gap: .5rem;
  }
  :is(body.category-builder-labs) {
    --callout-rail: 14px;
    --callout-icon-size: 26px;
    --callout-left-pad: calc(var(--callout-rail) + 8px);
  }
}

/* =========================================================
   Dark mode adjustments
   ========================================================= */
@media (prefers-color-scheme: dark){
  :is(body.category-builder-labs) {
    --lab-surface-dark: #0c0f14;
    --fg-strong: #edf2f8;

    --term-bg:     color-mix(in hsl,  var(--tone-term)    54%, var(--lab-surface-dark));
    --hint-bg:     color-mix(in hsl,  var(--tone-hint)    42%, var(--lab-surface-dark));
    --pro-bg:      color-mix(in hsl,  var(--tone-pro)     42%, var(--lab-surface-dark));
    --note-bg:     color-mix(in hsl,  var(--tone-note)    58%, var(--lab-surface-dark));
    --success-bg:  color-mix(in hsl,  var(--tone-success) 64%, var(--lab-surface-dark));
    --time-bg:     color-mix(in hsl,  var(--tone-time)    50%, var(--lab-surface-dark));
  }

  :is(body.category-builder-labs) .cooked blockquote{
    color: var(--fg-strong);
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.07),
      0 0 0 1px color-mix(in oklch, var(--callout-accent) 18%, transparent);
  }
}

/* =========================================================
   Responsive fallback
   On narrow screens, collapse to single column
   ========================================================= */
@media (max-width: 1024px){
  :is(body.category-builder-labs) #main-outlet {
    display: block !important;
  }
  :is(body.category-builder-labs) .container.posts .topic-navigation {
    position: static !important;
    max-height: none !important;
    margin-bottom: 1rem !important;
  }
  :is(body.category-builder-labs) .container.posts > .row {
    grid-column: auto !important;
  }
}

/* =========================================================
   Defensive: neutralize transforms that break sticky
   (Some themes transform ancestors; this keeps TOC sticky working)
   ========================================================= */
:is(body.category-builder-labs) .container.posts .topic-navigation,
:is(body.category-builder-labs) .container.posts .topic-navigation * {
  transform: none !important;
}


/* Scope strictly to the Builder Labs category page */
body.category-builder-labs #main-outlet,
body.category-builder-labs #main-outlet-wrap {
  overflow: visible !important;   /* sticky needs this */
}

/* Turn the posts container into a 2-column grid: [TOC | Content] */
body.category-builder-labs .container.posts {
  display: grid !important;
  grid-template-columns: minmax(16rem, 22rem) minmax(0, 1fr);
  column-gap: 2rem;
}

/* Put the Discourse TOC in the left column and make it sticky */
body.category-builder-labs .container.posts .topic-navigation {
  grid-column: 1 / 2 !important;
  align-self: start;
  position: sticky;
  top: 76px;                /* adjust if your header is taller/shorter */
  max-height: calc(100vh - 96px);
  overflow: auto;
  z-index: 1;
}

/* Put the actual topic content (the posts) in the right column */
body.category-builder-labs .container.posts > .row {
  grid-column: 2 / 3 !important;
}

/* Optional: remove the TOC’s default left border/padding so it hugs the rail */
body.category-builder-labs .topic-navigation .d-toc-main {
  border-left: none !important;
  padding-left: 0 !important;
  margin-left: 0 !important;
}

/* Narrow screens: fall back to single column */
@media (max-width: 1024px){
  body.category-builder-labs .container.posts {
    display: block !important;
  }
  body.category-builder-labs .container.posts .topic-navigation {
    position: static !important;
    max-height: none !important;
    margin-bottom: 1rem;
  }
}
/* ==== Scope: only on this category/topic page ==== */
body.category-builder-labs #main-outlet,
body.category-builder-labs #main-outlet-wrap { overflow: visible !important; }

/* Widen the topic page so the two-column layout has room */
body.category-builder-labs .wrap,
body.category-builder-labs .wrap .container {
  max-width: 1280px !important;   /* bump to 1280; change to 90vw if you want it fluid */
}

/* Two-column grid: [TOC | Content] */
body.category-builder-labs .container.posts {
  display: grid !important;
  grid-template-columns: 22rem minmax(0, 1fr);  /* wider content column */
  column-gap: 2rem;
}

/* Left rail TOC */
body.category-builder-labs .container.posts .topic-navigation {
  grid-column: 1 / 2 !important;
  align-self: start;
  position: sticky;
  top: 76px;                                  /* match your header height */
  max-height: calc(100vh - 96px);
  overflow: auto;
  z-index: 1;
}

/* Content column */
body.category-builder-labs .container.posts > .row {
  grid-column: 2 / 3 !important;
}

/* Tweak TOC visuals so it sits cleanly on the rail */
body.category-builder-labs .topic-navigation .d-toc-main {
  border-left: none !important;
  padding-left: 0 !important;
  margin-left: 0 !important;
}

/* Ensure headings don't hide under the sticky header when you jump via TOC */
body.category-builder-labs .cooked h1,
body.category-builder-labs .cooked h2,
body.category-builder-labs .cooked h3 { scroll-margin-top: 84px; }

/* Mobile/tablet: fall back to one column */
@media (max-width: 1024px){
  body.category-builder-labs .wrap,
  body.category-builder-labs .wrap .container { max-width: 100% !important; }
  body.category-builder-labs .container.posts { display: block !important; }
  body.category-builder-labs .container.posts .topic-navigation {
    position: static !important;
    max-height: none !important;
    margin-bottom: 1rem;
  }
}
/* ====== Topic layout: TOC on the left, content on the right (category-scoped) ====== */
body.category-builder-labs .wrap,
body.category-builder-labs .wrap .container {
  max-width: 1440px !important;
}

body.category-builder-labs .topic-area {
  display: grid !important;
  grid-template-columns: 22rem minmax(0, 1fr);
  column-gap: 2rem;
}

/* Left rail: built-in TOC */
body.category-builder-labs .topic-navigation {
  grid-column: 1 / 2 !important;
  align-self: start;
  position: sticky;
  top: 76px;                                   /* adjust to your header height */
  max-height: calc(100vh - 96px);
  overflow: auto;
  z-index: 1;
}

/* Content column */
body.category-builder-labs .topic-body,
body.category-builder-labs .post-stream,
body.category-builder-labs .topic-posts,
body.category-builder-labs .topic-post,
body.category-builder-labs .container.posts > .row {
  grid-column: 2 / 3 !important;
}

/* Prevent headings from hiding under sticky header when jumping from TOC */
body.category-builder-labs .cooked h1,
body.category-builder-labs .cooked h2,
body.category-builder-labs .cooked h3 { scroll-margin-top: 84px; }

/* If a right-side timeline appears, keep it with content column */
body.category-builder-labs .timeline-container { grid-column: 2 / 3; }

/* Mobile/tablet fallback */
@media (max-width: 1024px) {
  body.category-builder-labs .wrap,
  body.category-builder-labs .wrap .container { max-width: 100% !important; }
  body.category-builder-labs .topic-area { display: block !important; }
  body.category-builder-labs .topic-navigation {
    position: static !important;
    max-height: none !important;
    margin-bottom: 1rem;
  }
}
